# 🚘 파이썬을이용한데이터사이언스 캡스톤디자인1 연계실습 🚘
## 📢 깃허브 사용 규칙 
### 1. 담당 역할
데이터 전처리 : 김규리 , 데이터 시각화 : 최덕우 , 모델링 : 홍정민
### 2. 브랜치명
담당 작업
예시 -> 김규리의 전처리 : preprocessing
### 3. 파일 및 폴더명
본인 이름 _ 작업 내용
예시 -> 김규리의 교통사고 데이터 전처리 : kr_교통사고_전처리
### 4. commit할 때 
주요한 작업은 날짜와 작업 내용 적어주기
예시 -> [23.12.14] 교통사고 전처리 코드 업로드
## 🏃‍♂️ 기존 프로젝트 대비 개선된 상황 
### 1. 전처리
#### 기존의 전처리 내용
##### (1) 교통사고 데이터
- feature selection
    - ‘기상상태’, ‘노면상태’,’가해자 성별’ 등 프로젝트 분석 목적에 맞지 않은 feature 제거

#####  (2) 점멸신호 운영 현황 데이터

- “경찰서” 컬럼을 해당 경찰서가 소속된 자치구명으로 대치 및 오름차순 정렬
- 오타 수정
  - pdf파일을 excel로 변환하는 과정에서 발생한 오타 수정
- 시간 형식 통일
  - 일관되지 않은 시간제 점멸신호 운영시간을 자체적으로 정의한 기준에 따라 통일

##### (3) 생활인구 데이터

- 야간 시간대(0시 ~6시)의 데이터만 필터링
- 야간 시간대 기준 자치구별 생활인구수 1년간 평균 계산
- 상위, 하위 총 5개 자치구 선별
  - 앞서 구한 생활인구수 평균을 내림차순 정렬하여 선택

##### (4) 개선이 필요한 사항

데이터사이언스캡스톤디자인1을 수강할 당시 위의 모든 전처리 작업을 엑셀에서 직접 값을 수정하는 방식으로 해주었기에, 늘어나는 데이터 양과 효율성을 고려한 전처리 코드화 작업 요구됨

#### 개선된 전처리 내용

##### (1) 교통사고 데이터
- 컬럼 세분화
  - ‘사고일시’칼럼을 년도, 월, 일 ,시로 분리
  - ‘시군구’ 컬럼을 ‘서울특별시’ 값을 제거하고 자치구, 행정동으로 분리
  - ‘사고유형’컬럼을 ‘차대사람’이라는 값이 모두 동일함을 고려하여 ‘세부사고유형’만 분리
  - ‘도로형태’ 컬럼을 큰도로형태, 세부도로형태로 분리

##### (2) 점멸신호 운영 현황 데이터
- feature selection
    - ‘연번’, ‘교번’, ‘비고(날짜)’ 등 프로젝트 목적과 맞지 않은 feature 제거
- 시간 형식 통일을 위한 세분화
    - 시간제 운영 점멸신호의 경우 운영하는 요일과 시간대를 나타내는 값들의 매우 상이함을 고려하여 최대한 시간대를 컬럼으로 세분화
    - ‘매일1’,’매일2’,’평일’,’토요일’,일요일’,’특이사항’으로 구분
    - 예시로 한 교차로가 평일에 특정 시간, 주말에 전일 점멸하는 경우라면 ‘평일’컬럼에 평일 시간대 입력, ‘토요일’,’일요일’에 각각 주말에 운영하는 시간 값 기입
- 자치구별 운영하는 점멸신호 개수 파악
  - 항시와 시간제 점멸신호 모두 합한 개수 확인

##### (3) 생활인구 데이터
- 컬럼 세분화
    - ‘기준일ID’ 컬럼은 년도월일시간이 한꺼번에 나타는 형식이었기에 년도, 월, 일, 시간으로 세분화
- feature selection
  - 프로젝트 목적에 맞는 feature만 선택
- 자치구코드를 자치구명으로 대치
  - 자치구별 고유한 코드로 기입돼있던 값을 해당하는 자치구명으로 대치

#### 전처리의 주요한 개선된 사항 요약
1. 코드화 작업을 통해 효율화된 전처리 수행 가능
2. 데이터의 정규화 작업을 통해  활용할 수 있는 다양한 분석 수행
   
### 2. 시각화
#### 기존의 전처리 내용
##### (1) 자치구별 피해정도
- 서울시의 자치구 수나 이름등을 엑셀파일에서 직접 세어 확인
- 자치구별 총 교통사고 수나 피해정도에 따른 교통사고 수를 직접 세고 평균등 수기로 계산
- 피피티를 제작하면서 시각요소들을 사용해 그래프 시각화
- 유동인구수가 많은곳과 적은곳 기준으로 5개 자치구만을 뽑아 시각화

##### (2) 점멸신호 운영 교차로 표시
- 기존의 엑셀에서 경위도 컬럼을 직접 추가하여 매트릭스를 완성
- folium 라이브러리를 활용한 파이썬 코드 작성시 '교차로명, 경도, 위도'를 모든 행에서 하나씩 복사해가며 수기로 작성

#### 개선된 전처리 내용
##### (1) 자치구별 피해정도
- len, unique, groupby등 기본적인 파이썬 메소드를 사용
- matplotlib와 반복문을 사용해 서울시 25개 자치구 전체를 대상으로 그래프 표현
![자치구별_피해운전자_상해정도](https://github.com/ds-kyuree/pds_capstone1/assets/139933064/4d045370-6bf0-4bb2-befc-0a37918a5c0c)

##### (2) 점멸신호 운영 교차로 표시
- 판다스 라이브러리를 활용해 해당 엑셀파일을 읽어들이고 필요한 '교차로명, 경도, 위도' 값을 데이터프레임의 컬럼값으로 불러들임
<img width="684" alt="Screenshot 2023-12-19 at 4 37 40 PM" src="https://github.com/ds-kyuree/pds_capstone1/assets/139933064/eb001b8b-23bd-41e1-8c54-4830b9ae7649">

##### 시각화 주요 개선된 사항 요약
1. 자잘한 작업들은 기본적인 코드화로 수월하게 완료
2. 많은 데이터 불러올 때를 대비해 편리하고 효율성 높은 코드 작성

### 3. 모델링
#### 모델링 목표
선형 회귀 분석을 통해 자치구별 교통사고 발생률을 예측
#### 독립변수 및 종속변수 설정
##### 1. 독립변수
- 자치구별 2017 ~ 2022년도의 분기별 교통사고 총 발생건수
    - 1 ~ 3월 발생건수 / 4 ~ 6월 발생건수 / 7 ~ 9월 발생건수  / 10 ~ 12월 발생건수
-  자치구별 2017 ~ 2022년도의 분기별 생활인구수 평균
      - Quater1 / Quater2 / Quater3 / Quater4
- 자치구별 운영하는 총 점멸신호 개수
  
##### 2. 종속변수(타겟)
- 자치구별 2017 ~ 2022년도 기간의 생활인구수 대비 교통사고발생률
  
#### 데이터 스케일링
- 수치형 특성(자치구별 유동인구수, 분기별 교통사고율) 들을 표준화
    - 각 특성의 평균이 0이고 분산이 1이 되도록 조정하여 모델이 특성 간의 단위 차이에 영향을 받지 않도록 함
#### 모델 구축 및 학습
##### 선형 회귀 모델 학습
스케일링한 자치구별 분기별 유동인구수, 분기별 교통사고율을 독립변술 두고 타겟값을 교통사고 발생률로 하여 학습 진행
#### 모델 평가
테스트 데이터를 사용하여 모델이 예측한 값과 실제 값을 비교하여 모델의 성능을 평가
##### (1) R square (결정 계수)
- 예측 값이 종속 변수의 분산을 얼마나 잘 설명하는지 나타내는 지표로 1에 가까울수록 모델이 데이터를 잘 설명
<<<<<<< HEAD
- Train Set: 0.9043, Test Set: 0.3103으로 train 데이터의 경우 성능이 매우 뛰어난 것으로 나왔으나, test 데이터의 경우 모델이 새로운 데이터에 대한 설명력이 떨어져있다고 유추할 수 있는 수치가 나옴
-> train 데이터에 대한 과적합을 의심해볼 수 있음
##### (2) RMSE (평균 제곱근 오차)
- 예측 값과 실제 값 사이의 차이를 측정하는 지표. 값이 작을수록 모델의 예측이 더 좋음
- 1.0329e-07의 매우 작은 값으로 예측 성능이 뛰어나다고 나옴

##### (3) MSE (평균 제곱 오차)
- 오차의 제곱을 나타내는 지표로, 작을수록 모델의 예측이 정확
- 1.0668e-14의 매우 작은 값으로 예측 성능이 뛰어나다고 나옴
=======
- Train Set: 0.9128, Test Set: 0.3579으로 train 데이터의 경우 성능이 매우 뛰어난 것으로 나왔으나, test 데이터의 경우 모델이 새로운 데이터에 대한 설명력이 떨어져있다고 유추할 수 있는 수치가 나옴
-> train 데이터에 대한 과적합을 의심해볼 수 있음
##### (2) RMSE (평균 제곱근 오차)
- 예측 값과 실제 값 사이의 차이를 측정하는 지표. 값이 작을수록 모델의 예측이 더 좋음
- 9.9662e-08의 매우 작은 값으로 예측 성능이 뛰어나다고 나옴

##### (3) MSE (평균 제곱 오차)
- 오차의 제곱을 나타내는 지표로, 작을수록 모델의 예측이 정확
- 9.9326e-15의 매우 작은 값으로 예측 성능이 뛰어나다고 나옴
>>>>>>> forUpload

#### 예측 결과 시각화
모든 자치구를 대상으로 모델이 예측한 교통사고 발생률과 실제 교통사고 발생률을 시각화하여 비교하고, 예측의 정확성을 확인
<img width="946" alt="Screenshot 2023-12-19 at 3 45 04 PM" src="https://github.com/ds-kyuree/pds_capstone1/assets/139933064/f00e8f04-f8df-4df8-9637-571db06b1063">

#### 향후 발전시킬 점
- 점멸신호등과 관련한 교통공학적인 도메인을 학습하여, 실제 발생률에 영향을 주는 독립변수들을 추가하고 이를 통해 예측값과 실제값 간의 격차를 최소화
- 학습 데이터에 대한 과적합을 방지할 수 있도록 함
- 그 이후 발생율이 높은 자치구를 우선해서, 보행자의 안전을 향상시킬 수 있는 방안을 모색
